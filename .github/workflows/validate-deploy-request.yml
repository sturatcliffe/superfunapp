name: üëÄ Validate deploy request

env:
  pscale_base_directory: .pscale

on:
  pull_request: {}

jobs:
  validate_deploy_request:
    name: Validate deploy request
    runs-on: ubuntu-latest
    steps:
      - name: üîé Extract branch name
        shell: bash
        run: echo "##[set-output name=branch;]${GITHUB_REF#refs/heads/}"
        id: extract_branch

      - name: ‚¨áÔ∏è Checkout repo
        uses: actions/checkout@v3

      - name: üëÄ Validate deploy request
        id: validate_deploy_request
        env:
          PLANETSCALE_SERVICE_TOKEN_ID: ${{secrets.PLANETSCALE_SERVICE_TOKEN_ID}}
          PLANETSCALE_SERVICE_TOKEN: ${{secrets.PLANETSCALE_SERVICE_TOKEN}}
          ORG_NAME: ${{secrets.PLANETSCALE_ORG_NAME}}
          DB_NAME: ${{secrets.PLANETSCALE_DB_NAME}}
          BRANCH_NAME: ${{ github.event.inputs.branch }}
        working-directory: ${{env.pscale_base_directory}}/
        run: |
          ./validate-deploy-request.sh "$BRANCH_NAME"
